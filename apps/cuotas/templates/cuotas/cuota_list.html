{% extends "base.html" %}
{% load static %}
{% block title %}Cuotas{% endblock %}
{% block extra_styles %}
<link rel="stylesheet" href="{% static 'cuotas/css/cuotas.css' %}">
{% endblock %}

{% block content %}
<div class="cuotas-card">
  <div class="cuotas-header">
    <div>
      <h2>游눱 Cuotas {% if view.kwargs.inscripcion_id %}de inscripci칩n #{{ view.kwargs.inscripcion_id }}{% endif %}</h2>
      <p class="cuotas-header__subtitle">Marc치 pagadas y ajust치 importes si es necesario.</p>
    </div>
  </div>

  <form method="get" class="filters-row">
    <select name="pagada">
      <option value="">Todas</option>
      <option value="si" {% if request.GET.pagada == 'si' %}selected{% endif %}>Pagadas</option>
      <option value="no" {% if request.GET.pagada == 'no' %}selected{% endif %}>Pendientes</option>
    </select>
    <input type="number" name="mes" min="1" max="12" value="{{ request.GET.mes }}" placeholder="Mes" />
    <button class="btn btn-light" type="submit">Filtrar</button>
  </form>

  <div class="table-responsive">
    <table class="tabla-cuotas">
      <thead>
        <tr>
          <th>#</th><th>Inscripci칩n</th><th>Mes</th><th>Base</th><th>Desc.</th><th>Recargo</th><th>Total</th><th>Pagada</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for c in cuotas %}
          <tr>
            <td>{{ c.id }}</td>
            <td>#{{ c.inscripcion_id }}</td>
            <td>{{ c.mes }}</td>
            <td>${{ c.monto_base }}</td>
            <td>${{ c.monto_descuentos }}</td>
            <td>${{ c.monto_recargos }}</td>
            <td><strong>${{ c.total_a_pagar }}</strong></td>
            <td><span class="pill {{ c.pagada|yesno:'ok,no' }}">{{ c.pagada|yesno:'S칤,No' }}</span></td>
            <td class="actions">
              <a class="btn btn-ghost" href="{% url 'cuotas:cuota_update' c.pk %}">Editar</a>
              <a class="btn btn-danger-ghost" href="{% url 'cuotas:cuota_delete' c.pk %}">Eliminar</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="9" class="empty">No hay cuotas para mostrar.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
    <div class="paginacion">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-light">Anterior</a>
      {% endif %}
      <span>P치gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn btn-light">Siguiente</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'cuotas/js/cuotas.js' %}"></script>
{% endblock %}