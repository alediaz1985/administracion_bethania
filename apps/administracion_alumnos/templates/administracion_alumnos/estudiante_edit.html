{% extends 'base.html' %}
{% load static %}

{% block title %}Editar Ficha del Estudiante{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'administracion_alumnos/css/editar_alumno.css' %}">
{% endblock %}

{% block content %}
<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <div class="student-card">

    <!-- CABECERA -->
    <div class="student-header">
      <img src="{{ image_url }}" alt="Foto del Estudiante" class="student-photo">
      <div class="student-info">
        <h2>{{ estudiante.apellidos_estudiante }}, {{ estudiante.nombres_estudiante }}</h2>
        <p><strong>DNI:</strong> {{ estudiante.dni_estudiante }}</p>
        <p><strong>CUIL:</strong> {{ estudiante.cuil_estudiante }}</p>
      </div>
    </div>

    <!-- BOTONES -->
    <div class="student-actions">
      <button type="submit" class="btn">Guardar</button>
      <a href="{% url 'estudiante_list' %}" class="btn btn-light">Volver</a>
    </div>

    <!-- PESTAÑAS -->
    <div class="tabs">
      <button type="button" class="tab-button active" data-tab="datos">Datos Personales</button>
      <button type="button" class="tab-button" data-tab="inscripcion">Inscripción</button>
      <button type="button" class="tab-button" data-tab="academica">Académica</button>
      <button type="button" class="tab-button" data-tab="contacto">Contacto</button>
      <button type="button" class="tab-button" data-tab="salud">Salud</button>
      <button type="button" class="tab-button" data-tab="responsables">Responsables</button>
      <button type="button" class="tab-button" data-tab="documentacion">Documentación</button>
      <button type="button" class="tab-button" data-tab="estado">Estado Doc.</button>
    </div>

    <!-- DATOS PERSONALES (Estudiante) -->
    <div class="tab-content active" id="tab-datos">
      <table class="table-like">
        {{ est_form.non_field_errors }}
        <tr><th>Apellidos</th><td>{{ est_form.apellidos_estudiante }}</td></tr>
        <tr><th>Nombres</th><td>{{ est_form.nombres_estudiante }}</td></tr>
        <tr><th>Sexo</th><td>{{ est_form.sexo_estudiante }}</td></tr>
        <tr><th>Fecha de Nacimiento</th><td>{{ est_form.fecha_nac_estudiante }}</td></tr>
        <tr><th>Nacionalidad</th><td>{{ est_form.nacionalidad_estudiante }}</td></tr>
        <tr><th>Religión</th><td>{{ est_form.religion_estudiante }}</td></tr>
        <tr><th>CUIL</th><td>{{ est_form.cuil_estudiante }}</td></tr>
        <tr><th>DNI</th><td>{{ est_form.dni_estudiante }}</td></tr>
      </table>
    </div>

    <!-- INSCRIPCIÓN -->
    <div class="tab-content" id="tab-inscripcion">
      <table class="table-like">
        {{ insc_form.non_field_errors }}
        <tr><th>Marca Temporal</th><td>{{ insc_form.marca_temporal }}</td></tr>
        <tr><th>Email Registro</th><td>{{ insc_form.email_registro }}</td></tr>
        <tr><th>Foto</th><td>{{ insc_form.foto_estudiante }}</td></tr>
        <tr><th>N° Legajo</th><td>{{ insc_form.num_legajo_estudiante }}</td></tr>
        <tr><th>Fecha Recepción</th><td>{{ insc_form.fecha_recepcion }}</td></tr>
        <tr><th>Salita/Grado/Año</th><td>{{ insc_form.salita_grado_anio_estudiante }}</td></tr>
        <tr><th>Nivel</th><td>{{ insc_form.nivel_estudiante }}</td></tr>
        <tr><th>Curso/Año</th><td>{{ insc_form.curso_anio_estudiante }}</td></tr>
        <tr><th>Turno</th><td>{{ insc_form.turno_estudiante }}</td></tr>
        <tr><th>Nivel Enseñanza</th><td>{{ insc_form.nivel_ensenanza }}</td></tr>
      </table>
    </div>

    <!-- INFORMACIÓN ACADÉMICA -->
    <div class="tab-content" id="tab-academica">
      <table class="table-like">
        {{ info_form.non_field_errors }}
        <tr><th>Año Cursado</th><td>{{ info_form.anio_cursado }}</td></tr>
        <tr><th>Dónde Cursó</th><td>{{ info_form.donde_cursado }}</td></tr>
        <tr><th>Asignaturas Pendientes</th><td>{{ info_form.asignaturas_pendientes }}</td></tr>
        <tr><th>Indica Cuáles</th><td>{{ info_form.indica_asig_pendientes }}</td></tr>
        <tr><th>Tiene Hermanos</th><td>{{ info_form.tiene_hermanos_institucion }}</td></tr>
        <tr><th>Cuántos Hermanos</th><td>{{ info_form.cuantos_hermanos }}</td></tr>
        <tr><th>Cómo Conoció la Institución</th><td>{{ info_form.como_conociste_institucion }}</td></tr>
        <tr><th>Quién Eligió la Institución</th><td>{{ info_form.eligio_institucion }}</td></tr>
      </table>
    </div>

    <!-- CONTACTO -->
    <div class="tab-content" id="tab-contacto">
      <table class="table-like">
        {{ cont_form.non_field_errors }}
        <tr><th>Ciudad</th><td>{{ cont_form.ciudad_estudiante }}</td></tr>
        <tr><th>Provincia</th><td>{{ cont_form.provincia_estudiante }}</td></tr>
        <tr><th>Barrio</th><td>{{ cont_form.barrio_estudiante }}</td></tr>
        <tr><th>Calle</th><td>{{ cont_form.calle_estudiante }}</td></tr>
        <tr><th>N° / Mz / Pc</th><td>{{ cont_form.n_mz_pc_estudiante }}</td></tr>
        <tr><th>Código Postal</th><td>{{ cont_form.codigo_postal_estudiante }}</td></tr>
        <tr><th>Email</th><td>{{ cont_form.email_estudiante }}</td></tr>
        <tr><th>Tel. Fijo</th><td>{{ cont_form.tel_fijo_estudiante }}</td></tr>
        <tr><th>Tel. Celular</th><td>{{ cont_form.tel_cel_estudiante }}</td></tr>
        <tr><th>Tel. Emergencia</th><td>{{ cont_form.tel_emergencia_estudiante }}</td></tr>
        <tr><th>Parentesco</th><td>{{ cont_form.parentesco_estudiante }}</td></tr>
      </table>
    </div>

    <!-- SALUD -->
    <div class="tab-content" id="tab-salud">
      <table class="table-like">
        {{ salud_form.non_field_errors }}
        <tr><th>Peso</th><td>{{ salud_form.peso_estudiante }}</td></tr>
        <tr><th>Talla</th><td>{{ salud_form.talla_estudiante }}</td></tr>
        <tr><th>Obra Social</th><td>{{ salud_form.obra_social_estudiante }}</td></tr>
        <tr><th>Cuál</th><td>{{ salud_form.cual_osocial_estudiante }}</td></tr>
        <tr><th>Problema Neurológico</th><td>{{ salud_form.problema_neurologico_estudiante }}</td></tr>
        <tr><th>Cuál</th><td>{{ salud_form.cual_prob_neurologico_estudiante }}</td></tr>
        <tr><th>Problema Físico</th><td>{{ salud_form.problema_fisico_estudiante }}</td></tr>
        <tr><th>Certificado Médico</th><td>{{ salud_form.certificado_medico_estudiante }}</td></tr>
        <tr><th>Problema de Aprendizaje</th><td>{{ salud_form.problema_aprendizaje_estudiante }}</td></tr>
        <tr><th>Cuál</th><td>{{ salud_form.cual_aprendizaje_estudiante }}</td></tr>
        <tr><th>Atención Médica</th><td>{{ salud_form.atencion_medica_estudiante }}</td></tr>
        <tr><th>Alergias</th><td>{{ salud_form.alergia_estudiante }}</td></tr>
      </table>
    </div>

    <!-- RESPONSABLES (Inline Formset) -->
    <div class="tab-content" id="tab-responsables">
      {{ resp_fs.management_form }}
      {{ resp_fs.non_form_errors }}

      {% for form in resp_fs.forms %}
        {% for hidden in form.hidden_fields %}
          {{ hidden }}
        {% endfor %}

        <h4>{{ form.instance.apellidos }}, {{ form.instance.nombres }}</h4>
        <table class="table-like">
          {{ form.non_field_errors }}
          <tr><th>Apellidos</th><td>{{ form.apellidos }}</td></tr>
          <tr><th>Nombres</th><td>{{ form.nombres }}</td></tr>
          <tr><th>DNI</th><td>{{ form.dni }}</td></tr>
          <tr><th>Fecha Nac.</th><td>{{ form.fecha_nac }}</td></tr>
          <tr><th>Nacionalidad</th><td>{{ form.nacionalidad }}</td></tr>
          <tr><th>Estado Civil</th><td>{{ form.estado_civil }}</td></tr>
          <tr><th>CUIL</th><td>{{ form.cuil }}</td></tr>
          <tr><th>Nivel Instrucción</th><td>{{ form.nivel_instruccion }}</td></tr>
          <tr><th>Email</th><td>{{ form.email }}</td></tr>
          <tr><th>Tel. Fijo</th><td>{{ form.tel_fijo }}</td></tr>
          <tr><th>Tel. Celular</th><td>{{ form.tel_cel }}</td></tr>
          <tr><th>Tel. Laboral</th><td>{{ form.tel_laboral }}</td></tr>
          <tr><th>Horario Trabajo</th><td>{{ form.horario_trabajo }}</td></tr>
          <tr><th>Calle</th><td>{{ form.calle }}</td></tr>
          <tr><th>N° / Mz / Pc</th><td>{{ form.n_mz_pc }}</td></tr>
          <tr><th>Barrio</th><td>{{ form.barrio }}</td></tr>
          <tr><th>Ciudad</th><td>{{ form.ciudad }}</td></tr>
          <tr><th>Código Postal</th><td>{{ form.codigo_postal }}</td></tr>
          <tr><th>Provincia</th><td>{{ form.provincia }}</td></tr>
          {% if form.DELETE %}
            <tr><th>Eliminar</th><td>{{ form.DELETE }}</td></tr>
          {% endif %}
        </table>
        <hr>
      {% empty %}
        <p>No hay responsables cargados.</p>
      {% endfor %}
    </div>

    <!-- DOCUMENTACIÓN -->
    <div class="tab-content" id="tab-documentacion">
      <table class="table-like">
        {{ docu_form.non_field_errors }}
        <tr><th>Fecha Contrato</th><td>{{ docu_form.fecha_contrato }}</td></tr>
        <tr><th>Ciudad a los Días</th><td>{{ docu_form.ciudad_a_los_dias }}</td></tr>
        <tr><th>Señores 1</th><td>{{ docu_form.senores1 }}</td></tr>
        <tr><th>DNI Señores 1</th><td>{{ docu_form.dni_senores1 }}</td></tr>
        <tr><th>Señores 2</th><td>{{ docu_form.senores2 }}</td></tr>
        <tr><th>DNI Señores 2</th><td>{{ docu_form.dni_senores2 }}</td></tr>
        <tr><th>Domicilios Señores</th><td>{{ docu_form.domicilios_senores }}</td></tr>
        <tr><th>Domicilio Especial Electrónico</th><td>{{ docu_form.domicilio_especial_electronico }}</td></tr>
        <tr><th>Actúan Nombres Estudiante</th><td>{{ docu_form.actuan_nombres_estudiante }}</td></tr>
        <tr><th>DNI Actúan</th><td>{{ docu_form.dni_acutan_estudiante }}</td></tr>
        <tr><th>Domicilio Actúan</th><td>{{ docu_form.domicilio_actuan_estudiante }}</td></tr>
        <tr><th>Responsable Pago</th><td>{{ docu_form.responsable_pago }}</td></tr>
        <tr><th>DNI Responsable Pago</th><td>{{ docu_form.dni_responsable_pago }}</td></tr>
        <tr><th>Manifiesta Responsable</th><td>{{ docu_form.manifiesta_responsable }}</td></tr>
        <tr><th>Autoriza Facturación A</th><td>{{ docu_form.autoriza_facturacion_a }}</td></tr>
        <tr><th>Autoriza Imagen</th><td>{{ docu_form.autoriza_imagen }}</td></tr>
      </table>
    </div>

    <!-- ESTADO -->
    <div class="tab-content" id="tab-estado">
      <table class="table-like">
        {{ estd_form.non_field_errors }}
        <tr><th>Estado Actual</th><td>{{ estd_form.estado }}</td></tr>
        <tr><th>Última Actualización</th><td><em>se actualiza automáticamente</em></td></tr>
      </table>
    </div>

  </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabButtons = document.querySelectorAll(".tab-button");
  const tabContents = document.querySelectorAll(".tab-content");
  tabButtons.forEach(button => {
    button.addEventListener("click", () => {
      const tabId = button.getAttribute("data-tab");
      tabButtons.forEach(btn => btn.classList.remove("active"));
      tabContents.forEach(tab => tab.classList.remove("active"));
      button.classList.add("active");
      document.getElementById("tab-" + tabId).classList.add("active");
    });
  });
});
</script>
{% endblock %}
