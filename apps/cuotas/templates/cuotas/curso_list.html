{% extends "base.html" %}
{% load static %}

{% block title %}Cursos{% endblock %}
{% block extra_styles %}
<link rel="stylesheet" href="{% static 'cuotas/css/cursos.css' %}">
{% endblock %}

{% block content %}
<div class="student-card cuotas-card">
  <div class="student-header cuotas-header">
    <div>
      <h2>Cursos</h2>
      <p class="cuotas-header__subtitle">Gestioná cursos por nivel. Total: <strong>{{ total }}</strong></p>
    </div>
    <div class="student-actions">
      <a class="btn" href="{% url 'cuotas:curso_create' %}">+ Nuevo curso</a>
      <a class="btn btn-light" href="{% url 'cuotas:curso_list' %}">Limpiar filtros</a>
    </div>
  </div>

  {# Mensajes (si usás contrib.messages) #}
  {% if messages %}
    {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <form method="get" class="form-row">
    <input class="form-control" type="text" name="q" placeholder="Buscar por curso o nivel…" value="{{ q }}">
    <select name="nivel" class="form-select">
      <option value="">— Todos los niveles —</option>
      {% for n in niveles %}
        <option value="{{ n.id }}" {% if nivel_seleccionado == n.id|stringformat:"s" %}selected{% endif %}>{{ n.nombre }}</option>
      {% endfor %}
    </select>
    <button class="btn" type="submit">Filtrar</button>
  </form>

  <div class="table-wrap">
    <table class="table-min">
      <thead>
        <tr>
          <th> Nivel </th>
          <th> Curso </th>
          <th class="text-end"> Cuota (override) </th>
          <th class="text-end"> Inscripción (override) </th>
          <th class="text-end"> Acciones </th>
        </tr>
      </thead>
      <tbody>
        {% for c in cursos %}
          <tr>
            <td>{{ c.nivel.nombre }}</td>
            <td>{{ c.nombre }}</td>
            <td class="text-end">
              {% if c.monto_cuota_override %}
                ${{ c.monto_cuota_override }}
              {% else %}
                <span class="form-help">—</span>
              {% endif %}
            </td>
            <td class="text-end">
              {% if c.monto_inscripcion_override %}
                ${{ c.monto_inscripcion_override }}
              {% else %}
                <span class="form-help">—</span>
              {% endif %}
            </td>
            <td>
              <div class="table-actions">
                <a class="btn btn-light" href="{% url 'cuotas:curso_update' c.id %}">Editar</a>
                <a class="btn btn-light" href="{% url 'cuotas:curso_delete' c.id %}">Borrar</a>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5" style="text-align:center; padding:1rem; color:var(--secundario);">Sin resultados</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}&nivel={{ nivel_seleccionado }}">Anterior</a>
      {% else %}<span>Anterior</span>{% endif %}

      <span class="active">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&q={{ q }}&nivel={{ nivel_seleccionado }}">Siguiente</a>
      {% else %}<span>Siguiente</span>{% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
