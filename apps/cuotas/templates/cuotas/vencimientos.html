{% extends "base.html" %}
{% load static %}

{% block title %}Vencimientos Mensuales{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'cuotas/css/vencimientos.css' %}">
{% endblock %}

{% block content %}
<div class="student-card cuotas-card">

  <!-- Encabezado -->
  <div class="student-header cuotas-header">
    <div>
      <h2>üìÖ Vencimientos Mensuales</h2>
      <p class="cuotas-header__subtitle">Configuraci√≥n de d√≠as l√≠mite y recargos por ciclo lectivo.</p>
    </div>
    <div class="student-actions">
      <a class="btn" href="{% url 'cuotas:vencimiento_create' %}">+ Nuevo vencimiento</a>
      <button class="btn btn-light btn-xs" type="button" id="btn-export">Exportar CSV</button>
    </div>
  </div>

  <!-- Estado -->
  <div class="status aprobado">
    <strong>Tip:</strong>
    <span class="muted">
      Hac√© clic en una fila para editar el vencimiento. Us√° el filtro r√°pido para buscar por a√±o o mes.
    </span>
  </div>

  <!-- Tabs -->
  <div class="tabs" role="tablist">
    <button class="tab-button active" data-tab="tab-listado" role="tab">Listado</button>
  </div>

  <!-- Contenido -->
  <section id="tab-listado" class="tab-content active" role="tabpanel">
    <!-- Filtro -->
    <div class="form-grid" style="margin-bottom:.8rem;">
      <p>
        <label for="filter-q">Filtro r√°pido</label>
        <input type="text" id="filter-q" value="{{ q }}" placeholder="Buscar por a√±o, mes o texto‚Ä¶ (ej: 2025, 03)">
        <span class="hint">Atajo: presion√° <kbd>/</kbd> para enfocar el filtro</span>
      </p>
    </div>

    {% if vencimientos %}
      <div class="table-wrap">
        <table class="table-like" id="tabla-vencimientos">
          <thead>
            <tr>
              <th>A√±o</th>
              <th>Mes</th>
              <th>D√≠a sin recargo</th>
              <th>Recargo %</th>
              <th>Observaciones</th>
              <th class="col-actions">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for v in vencimientos %}
              <tr class="row-click" data-url="{% url 'cuotas:vencimiento_update' v.pk %}">
                <td>{{ v.ciclo.anio }}</td>
                <td>{{ v.mes|stringformat:"02d" }}</td>
                <td>{{ v.dia_ultimo_sin_recargo }}</td>
                <td>
                  {% if v.recargo_porcentaje %}
                    <span class="badge success">{{ v.recargo_porcentaje }}%</span>
                  {% else %}
                    <span class="badge muted">0%</span>
                  {% endif %}
                </td>
                <td class="muted">
                  {# tu modelo no tiene 'descripcion', esto queda como gui√≥n #}
                  ‚Äî
                </td>
                <td class="col-actions">
                  <a class="btn btn-light btn-xs" href="{% url 'cuotas:vencimiento_update' v.pk %}">Editar</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if is_paginated %}
        <div class="pagination" style="display:flex; gap:.5rem; margin-top:.8rem;">
          {% if page_obj.has_previous %}
            <a class="btn btn-light" href="?page={{ page_obj.previous_page_number }}&q={{ q }}">‚Üê Anterior</a>
          {% endif %}
          <span class="badge muted">P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
          {% if page_obj.has_next %}
            <a class="btn btn-light" href="?page={{ page_obj.next_page_number }}&q={{ q }}">Siguiente ‚Üí</a>
          {% endif %}
        </div>
      {% endif %}
    {% else %}
      <div class="empty">
        No hay vencimientos configurados a√∫n.
        <div style="margin-top:.6rem;">
          <a class="btn" href="{% url 'cuotas:vencimiento_create' %}">Crear el primero</a>
        </div>
      </div>
    {% endif %}
  </section>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'cuotas/js/vencimientos.js' %}"></script>
{% endblock %}
