{% extends "base.html" %}
{% load static %}

{% block title %}Cobrar cuota{% endblock %}

{% block content %}
<div class="student-card cuotas-card">
  <div class="student-header cuotas-header">
    <div>
      <h2>üßæ Cobrar cuota</h2>
      <p class="cuotas-header__subtitle">
        Inscripci√≥n: {{ cuota.inscripcion }} ‚Äî Ciclo {{ cuota.inscripcion.ciclo.anio }} ‚Äî Mes {{ cuota.mes }}
      </p>
    </div>
  </div>

  <div class="grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:1.25rem; margin-top:1rem;">
    <!-- Formulario -->
    <div class="card p-3" style="border:1px solid #e6e6e6; border-radius:10px;">
      <h4>Datos de pago</h4>
      <form method="post" novalidate>
        {% csrf_token %}
        <div class="mb-3">
          <label class="form-label">{{ form.fecha_pago.label }}</label>
          {{ form.fecha_pago }}
          {% if form.fecha_pago.help_text %}<small class="text-muted d-block">{{ form.fecha_pago.help_text }}</small>{% endif %}
          {% for e in form.fecha_pago.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
        </div>

        <div class="mb-3">
          <label class="form-label">{{ form.descuento.label }}</label>
          {{ form.descuento }}
          {% if form.descuento.help_text %}<small class="text-muted d-block">{{ form.descuento.help_text }}</small>{% endif %}
          {% for e in form.descuento.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Confirmar cobro</button>
          <a class="btn btn-light" href="{% url 'cuota_list' cuota.inscripcion_id %}">Cancelar</a>
        </div>
      </form>
    </div>

    <!-- Simulaci√≥n -->
    <div class="card p-3" style="border:1px solid #e6e6e6; border-radius:10px;">
      <h4>Simulaci√≥n</h4>
      <ul class="list-unstyled">
        <li>Importe base: <strong>${{ cuota.importe_base }}</strong></li>
        <li>Descuento actual: <strong>${{ cuota.descuento|default:"0.00" }}</strong></li>
        <li>Base neta: <strong>${{ base_neta }}</strong></li>
        <li>Fecha corte (sin recargo): <strong>{{ sim.fecha_corte|date:"d/m/Y" }}</strong></li>
        <li>Aplica recargo: <strong>{% if sim.aplica_recargo %}S√≠{% else %}No{% endif %}</strong></li>
        <li>Porcentaje recargo: <strong>{{ sim.porcentaje }}%</strong></li>
        <li>Recargo: <strong>${{ sim.recargo }}</strong></li>
        <li>Total a pagar: <strong style="font-size:1.15rem;">${{ sim.total }}</strong></li>
      </ul>
      <p class="text-muted" style="margin-top:.5rem;">
        * La simulaci√≥n usa la fecha del formulario. Al confirmar, se recalcula y guarda definitivamente.
      </p>
    </div>
  </div>

  <div style="margin-top:1rem;">
    <a class="btn btn-light" href="{% url 'cuota_list' cuota.inscripcion_id %}">‚Üê Volver al listado</a>
  </div>
</div>
{% endblock %}
