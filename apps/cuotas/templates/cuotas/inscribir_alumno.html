{% extends 'base.html' %}

{% block title %}Inscripción de Alumnos{% endblock %}

{% load static %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'cuotas/css/inscribir_alumno.css' %}">
{% endblock %}

{% block content %}

<h1>Buscar Estudiantes por CUIL</h1>

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li {% if message.tags %} class="{{ message.tags }}" {% endif %}>
                {{ message }}
            </li>
        {% endfor %}
    </ul>
{% endif %}

<!-- Formulario de búsqueda -->
<form method="get">
    <label for="q">CUIL del estudiante:</label>
    <input type="text" name="q" id="q" value="{{ query }}">
    <button type="submit">Buscar</button>
</form>    

{% if query %}
    <h2>Resultados de la búsqueda</h2>

    {% if resultados %}
        <ul>
            {% for resultado, subnivel in resultados %}
                <li>
                    <strong>{{ resultado.estudiante.nombres_estudiante }} {{ resultado.estudiante.apellidos_estudiante }}</strong><br>
                    <strong>Subnivel:</strong> {{ subnivel }}<br>
                    <strong>Estado de Documentación:</strong> {{ resultado.estado }}<br><br>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No se encontraron resultados para el CUIL proporcionado.</p>
    {% endif %}

    {% if mensaje_documentacion_no_aprobada %}
        <p>{{ mensaje_documentacion_no_aprobada }}</p>
    {% endif %}
{% endif %}

{% if resultados %}
    <h2>Inscripción</h2>

    <form method="post">
        {% csrf_token %}

        <!-- Ciclo Lectivo -->
        <label for="ciclo">Ciclo Lectivo:</label>
        <select name="ciclo" id="ciclo" required>
            <option value="">-- Seleccioná un ciclo --</option>
            {% for ciclo in ciclos_lectivos %}
                <option value="{{ ciclo.id }}">{{ ciclo.año_lectivo }}</option>
            {% endfor %}
        </select>

        <br><br>

        <!-- Subnivel -->
        <label for="subnivel">Subnivel:</label>
        <select name="subnivel" id="subnivel" required>
            <option value="">-- Seleccioná un subnivel --</option>
            {% for subnivel in subniveles_disponibles %}
                <option value="{{ subnivel.id }}">{{ subnivel }}</option>
            {% endfor %}
        </select>

        <br><br>

        <!-- Monto de Inscripción -->
        <label for="monto_inscripcion">Monto de Inscripción:</label>
        <select name="monto_inscripcion" id="monto_inscripcion" required>
            <option value="">-- Seleccioná un monto --</option>
            {% for monto in montos_disponibles %}
                <option value="{{ monto.monto_inscripcion }}">{{ monto.subnivel_cursado.nombre }}: {{ monto.monto_inscripcion|floatformat:2 }}</option>
            {% endfor %}
        </select>

        <br><br>

        <!-- Descuento por Inscripción -->
        <label for="descuento_inscripcion">Descuento por Inscripción:</label>
        <input type="number" name="descuento_inscripcion" id="descuento_inscripcion" step="0.01" value="0" required>

        <br><br>

        <!-- Pago -->
        <label for="pagada">¿Está pagada?</label>
        <input type="checkbox" name="pagada" id="pagada">

        <br><br>

        <button type="submit">Inscribir</button>
    </form>
{% endif %}

{% endblock %}


