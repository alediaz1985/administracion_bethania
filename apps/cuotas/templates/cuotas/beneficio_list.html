{% extends "base.html" %}
{% load static %}
{% block title %}Beneficios{% endblock %}
{% block extra_styles %}<link rel="stylesheet" href="{% static 'cuotas/css/beneficios.css' %}">{% endblock %}

{% block content %}
<div class="cuotas-card">
  <div class="cuotas-header">
    <div>
      <h2>üéüÔ∏è Beneficios / Descuentos</h2>
      <p class="cuotas-header__subtitle">Cre√° y administr√° beneficios aplicables a inscripciones.</p>
    </div>
    <div class="student-actions">
      <a class="btn" href="{% url 'cuotas:beneficio_create' %}">Nuevo beneficio</a>
    </div>
  </div>

  <form method="get" class="filters-row">
    <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Buscar por nombre‚Ä¶"/>
    <select name="estado">
      <option value="">Todos</option>
      <option value="activos" {% if request.GET.estado == 'activos' %}selected{% endif %}>Activos</option>
      <option value="inactivos" {% if request.GET.estado == 'inactivos' %}selected{% endif %}>Inactivos</option>
    </select>
    <button class="btn btn-light" type="submit">Filtrar</button>
  </form>

  <div class="table-responsive">
    <table class="tabla-cuotas">
      <thead>
        <tr>
          <th>#</th><th>Nombre</th><th>Tipo</th><th>%</th><th>Monto</th><th>Prioridad</th><th>Activo</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for b in beneficios %}
          <tr data-url="{% url 'cuotas:beneficio_update' b.pk %}">
            <td>{{ b.id }}</td>
            <td>{{ b.nombre }}</td>
            <td>{{ b.get_tipo_display }}</td>
            <td>{% if b.porcentaje %}{{ b.porcentaje }}%{% else %}-{% endif %}</td>
            <td>{% if b.monto_fijo %}${{ b.monto_fijo }}{% else %}-{% endif %}</td>
            <td>{{ b.prioridad }}</td>
            <td><span class="pill {{ b.activo|yesno:'ok,no' }}">{{ b.activo|yesno:'S√≠,No' }}</span></td>
            <td class="actions">
              <a class="btn btn-ghost" href="{% url 'cuotas:beneficio_update' b.pk %}">Editar</a>
              <a class="btn btn-danger-ghost" href="{% url 'cuotas:beneficio_delete' b.pk %}">Eliminar</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="8" class="empty">No hay beneficios cargados.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
    <div class="paginacion">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-light">Anterior</a>
      {% endif %}
      <span>P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn btn-light">Siguiente</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'cuotas/js/beneficios.js' %}"></script>
{% endblock %}