{% extends "base.html" %}
{% block title %}GestiÃ³n de Ciclos Lectivos{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">ðŸ“… GestiÃ³n de Ciclos Lectivos</h2>

  <!-- Ciclo activo actual -->
  {% if CUOTAS_CICLO_ACTIVO %}
    <div class="alert alert-success">
      <strong>Ciclo activo:</strong> {{ CUOTAS_CICLO_ACTIVO.anio }} 
      ({{ CUOTAS_CICLO_ACTIVO.fecha_inicio }} â†’ {{ CUOTAS_CICLO_ACTIVO.fecha_fin }})
    </div>
  {% else %}
    <div class="alert alert-danger">
      <strong>No hay ciclo activo.</strong> Crea o activa uno nuevo.
    </div>
  {% endif %}

  <!-- Formulario de creaciÃ³n -->
  <div class="card mb-4">
    <div class="card-header bg-light">
      <strong>âž• Crear nuevo ciclo</strong>
    </div>
    <div class="card-body">
      <form method="post" class="row g-3">
        {% csrf_token %}
        {{ form.as_p }}
        <div class="col-12">
          <button class="btn btn-success" type="submit">Crear Ciclo</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de ciclos -->
  <div class="card">
    <div class="card-header bg-light">
      <strong>ðŸ“˜ Ciclos existentes</strong>
    </div>
    <div class="card-body">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>AÃ±o</th>
            <th>Fecha Inicio</th>
            <th>Fecha Fin</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for ciclo in ciclos %}
          <tr>
            <td>{{ ciclo.anio }}</td>
            <td>{{ ciclo.fecha_inicio }}</td>
            <td>{{ ciclo.fecha_fin }}</td>
            <td>
              {% if ciclo.activo %}
                <span class="badge bg-success">Activo</span>
              {% else %}
                <span class="badge bg-secondary">Inactivo</span>
              {% endif %}
            </td>
            <td>
              {% if not ciclo.activo %}
                <a href="{% url 'cuotas:activar_ciclo' ciclo.id %}" class="btn btn-sm btn-outline-primary">
                  Activar
                </a>
              {% else %}
                <button class="btn btn-sm btn-success" disabled>Activo</button>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center">No hay ciclos creados aÃºn.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
