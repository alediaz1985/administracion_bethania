{% extends "base.html" %}
{% load static %}

{% block title %}{{ titulo }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="m-0">{{ titulo }}</h3>
    <form class="d-flex" method="get">
      <input class="form-control form-control-sm me-2" type="search" name="q"
             value="{{ request.GET.q }}" placeholder="Buscar...">
      {% for k,v in request.GET.items %}
        {% if k != "q" and k != "page" %}
          <input type="hidden" name="{{ k }}" value="{{ v }}">
        {% endif %}
      {% endfor %}
      <button class="btn btn-sm btn-primary">Buscar</button>
    </form>
  </div>

  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover align-middle m-0">
        <thead class="table-light">
          <tr>
            {% for th,acc in columnas %}<th>{{ th }}</th>{% endfor %}
            <th style="width:1%"></th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              {% if tipo == "estudiantes" %}
                <td>{% firstof r.id "—" %}</td>
                <td>{% firstof r.apellidos_estudiante r.apellidos r.last_name "—" %}</td>
                <td>{% firstof r.nombres_estudiante r.nombres r.first_name "—" %}</td>
                <td>{% firstof r.cuil_estudiante r.documento "—" %}</td>
                <td>
                  <a class="btn btn-sm btn-outline-primary"
                     href="{% url 'dashboard:lista_inscripciones' %}?q={% firstof r.cuil_estudiante r.documento r.id %}">
                     Ver inscripciones
                  </a>
                </td>

              {% elif tipo == "inscripciones" %}
                <td>{{ r.id }}</td>
                <td>{{ r.estudiante }}</td>
                <td>{{ r.nivel_estudiante|default:"—" }}</td>
                <td>{{ r.turno_estudiante|default:"—" }}</td>
                <td>
                  <a class="btn btn-sm btn-outline-secondary"
                     href="{% url 'dashboard:lista_contactos' %}?q={% firstof r.estudiante.cuil_estudiante r.estudiante.documento r.estudiante.id %}">
                     Ver contacto
                  </a>
                </td>

              {% elif tipo == "contactos" %}
                <td>{{ r.id }}</td>
                <td>{{ r.estudiante }}</td>
                <td>{{ r.email_estudiante|default:"—" }}</td>
                <td>{{ r.tel_cel_estudiante|default:"—" }}</td>
                <td>{{ r.ciudad_estudiante|default:"—" }}</td>
                <td>
                  <a class="btn btn-sm btn-outline-secondary"
                     href="{% url 'dashboard:lista_estudiantes' %}?q={% firstof r.estudiante.cuil_estudiante r.estudiante.documento r.estudiante.id %}">
                     Ver estudiante
                  </a>
                </td>
              {% endif %}
            </tr>
          {% empty %}
            <tr><td colspan="{{ columnas|length|add:1 }}" class="text-center text-muted">Sin resultados</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if is_paginated %}
      <div class="card-footer">
        <nav>
          <ul class="pagination pagination-sm m-0">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode|cut:'page='|cut:'&page=' }}">«</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">«</span></li>
            {% endif %}

            <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode|cut:'page='|cut:'&page=' }}">»</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">»</span></li>
            {% endif %}
          </ul>
        </nav>
      </div>
    {% endif %}
  </div>

  <div class="mt-3">
    <a class="btn btn-sm btn-light" href="{% url 'dashboard:panel' %}">← Volver al panel</a>
  </div>
</div>
{% endblock %}
