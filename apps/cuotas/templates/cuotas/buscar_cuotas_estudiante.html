{% extends 'base.html' %}
{% load static %}

{% block title %}Estado de Cuotas de Alumnos{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'cuotas/css/buscar_cuotas.css' %}">
{% endblock %}

{% block content %}
<article class="estado-cuotas">

  <!-- Sección de Búsqueda -->
  <section class="estado-cuotas__busqueda">
    <form method="post" class="estado-cuotas__formulario">
      {% csrf_token %}

      <div class="estado-cuotas__grupo">
        <label for="cuil" class="estado-cuotas__etiqueta">CUIL del Estudiante:</label>
        <input type="text" id="cuil" name="cuil_estudiante" required class="estado-cuotas__input">
      </div>

      <div class="estado-cuotas__grupo">
        <label for="ciclo_lectivo" class="estado-cuotas__etiqueta">Ciclo lectivo:</label>
        <select name="ciclo_lectivo" id="ciclo_lectivo" required class="estado-cuotas__select">
          <option value="">Seleccionar año</option>
          {% for ciclo in ciclos_lectivos %}
            <option value="{{ ciclo.id }}" {% if ciclo.id == ciclo_seleccionado %}selected{% endif %}>
              {{ ciclo.año_lectivo }}
            </option>
          {% endfor %}
        </select>
      </div>

      <button type="submit" class="boton-accion">
        <span class="boton-accion__circulo" aria-hidden="true">
          <span class="boton-accion__icono boton-accion__icono--flecha"></span>
        </span>
        <span class="boton-accion__texto">Buscar</span>
      </button>

    </form>
  </section>

  <!-- Sección de Resultados -->
  <section class="estado-cuotas__resultados">
    <h2 class="titulo-secundario">Resultados:</h2>
    {% if estudiante %}
      <div class="estado-cuotas__titulo">
        <strong>Estudiante:</strong> {{ estudiante.apellidos_estudiante }}, {{ estudiante.nombres_estudiante }}
      </div>
    {% endif %}

    {% if inscripcion %}
      <p class="estado-cuotas__info">
        <strong>Subnivel:</strong> {{ inscripcion.subnivel_cursado.nombre }}
      </p>

      <h3 class="estado-cuotas__subtitulo">
        Cuotas del Ciclo {{ inscripcion.ciclo_lectivo.año_lectivo }}
      </h3>

      <table class="estado-cuotas__tabla">
        <thead>
          <tr>
            <th>Mes</th>
            <th>Monto</th>
            <th>Pagado</th>
            <th>Interés</th>
            <th>Total a Pagar</th>
            <th>Fecha de Pago</th>
          </tr>
        </thead>
        <tbody>
          {% for cuota in cuotas %}
          <tr>
            <td>{{ cuota.mes }}</td>
            <td>${{ cuota.monto_cuota }}</td>
            <td>{{ cuota.pagado|yesno:"Sí,No" }}</td>
            <td>${{ cuota.interes_aplicado }}</td>
            <td>${{ cuota.total_a_pagar }}</td>
            <td>{{ cuota.fecha_pago|default:"-" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    {% elif not inscripcion %}
      <p class="estado-cuotas__mensaje-error">
        Este estudiante no tiene inscripción en el ciclo lectivo ingresado.
      </p>
    {% endif %}
  </section>

</article>
{% endblock %}
